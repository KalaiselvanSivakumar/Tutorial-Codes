<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Chat Application</title>
	<link rel="stylesheet" href="./bootstrap.min.css">
	<script src="./jquery-3.2.1.min.js"></script>
	<script src="./popper.min.js"></script>
	<script src="socket.io.js"></script>
	<script src="./bootstrap.min.js"></script>
</head>
<body>
	<div class="container">
		<br>
		<div class="jumbotron">
			<h1 class="display-4">Start Chatting</h1>
			<br>
			<input type="text" name="txtName" id="txtName" class="form-control" placeholder="Name">
			<br>
			<textarea name="txtMessage" id="txtMessage" class="form-control" placeholder="Message"></textarea>
			<br>
			<button id="send" class="btn btn-success">Send</button>
		</div>
		<div id="messages"></div>
	</div>
	<script>
		function onReady(callBackFunction) {
			if (document.readyState != 'loading') {
				callBackFunction();
			}
			else {
				document.addEventListener('DOMContentLoaded', callBackFunction);
			}
		}

		function sendChat(content) {
			console.log(content);
			$.post("/chats", content);
		}

		function getChat() {
			displayEl.innerHTML = '';
			$.get('/chats', (chats) => {
				chats.forEach(displayChat);
			});
		}

		function displayChat(chatObj) {
			displayEl.innerHTML += `<h5>${chatObj.name} </h5><p>${chatObj.message}</p>`;
		}

		var displayEl;

		function main() {
			console.log('DOM Content is loaded. Application is ready to use now');

			displayEl = document.getElementById('messages');

			var sendButton = document.getElementById('send');
			sendButton.addEventListener('click', () => {
				var chatContent = {
					name	: document.getElementById('txtName').value,
					message	: document.getElementById('txtMessage').value
				}
				sendChat(chatContent);
			});

		}
		onReady(main);

		var socket = io();
		socket.on('chat', getChat);
	</script>
</body>
</html>